---
title: VPN 技术概览与协议分析
description: 探讨 VPN 的核心原理、主流协议（IPsec, OpenVPN, WireGuard）及其安全性分析。
keywords: VPN, 网络安全, 加密协议, 远程访问, 网络架构
---

# VPN 技术原理与代理协议分析

## 1. 核心链路与数据流转
APP -> 主机 -> GFW -> 代理服务器 -> 目标

## 2. 虚拟网卡基础：TAP 与 TUN
### 2.1 TAP/TUN 的技术区别
- **tun** 是三层设备，是 PPP 点对点设备，没有 MAC 地址，其封装的外层是 IP 头。
- **tap** 是二层设备，以太网设备，有 MAC 地址，其封装的外层是以太网数据帧 (frame) 头。
- **tap** 比 tun 更接近于物理网卡，可以认为 tap 设备等价于去掉了硬件功能的物理网卡。

### 2.2 工作原理与数据交换
相比于物理网卡负责内核网络协议栈和外界网络之间的数据传输，虚拟网卡的两端则是内核网络协议栈 and 用户空间，它负责在内核网络协议栈和用户空间的程序之间传递数据：

发送到虚拟网卡的数据来自于用户空间，然后被内核读取到网络协议栈中；内核写入虚拟网卡，准备通过该网卡发送的数据，目的地是用户空间。

作为虚拟网卡驱动，Tun/tap 驱动程序的数据接收和发送并不直接和真实网卡打交道，而是通过用户态来转交。

![vpn_data_flow](./rsc/vpn_data_flow.png)
## 3. 网络专线与骨干网核心概念
### 3.1 IPLC 与 BGP 中转
中转使得出国相对更稳定一点，**BGP** 是中转的一种方式，有的过墙有的不过。**IPLC**（International Private Leased Circuit，国际专线）通常不过墙。目前机场语境下的 IPLC 主要指阿里云内网（如深港专线：深圳阿里云 -- 香港阿里云），具有极高的性价比。

### 3.2 原生 IP 与广播 IP
- **原生 IP (Native IP)**：指 IP 的注册地址与服务器所在的国家/地区一致。通常不用于公有云服务，声誉较好，可解锁 Netflix、HBO 等流媒体。
- **广播 IP**：IP 的归属地与服务器物理位置不符，是从其他地区广播过来的。

### 3.3 流媒体解锁原理
流媒体平台（如 Netflix）会根据 IP 归属地限制访问。家宽（家庭宽带）和商宽 IP 被屏蔽的几率最低。IDC（数据中心）IP 极易被封。

### 3.4 运营商线路与加速技术
- **CN2**：电信精品骨干网，相比普通 163 线路具有更好的稳定性。
- **三巨头 (AWS/Azure/GCP)**：线路质量优异，常用于流媒体解锁。
- **TCP 加速**：如 BBR-Plus，用于优化高延迟链路的吞吐量。

## 4. 代理协议演进与对抗技术
### 4.1 协议发展历程
`VPN -> SS/SSR -> V2Ray -> Trojan`

- **VPN**：运行在数据链路层，缺乏特征对抗能力。常见协议包括 PPTP、L2TP、IPSec、OpenVPN 等。
![vpn_protocols_comparison](./rsc/vpn_protocols_comparison.png)

- **Socks5**：会话层协议。
- **V2Ray**：支持复杂协议组合（如 VMess + WebSocket + TLS）。

### 4.2 QoS 优化与网关模式
运营商会通过 **QoS (Quality of Service)** 对不同流量（流媒体、游戏、HTTP）设置优先级。网关模式代理则是通过透明代理技术，让局域网内所有设备无感知使用。

### 4.3 流量识别与探测规避
GFW 会通过 TCP Reset 包进行嗅探。现代协议（如 Trojan）倾向于伪装成正常的 HTTPS 流量。常用的客户端如 Clash 会通过特定的 URL（如 gstatic.com）进行自动测速，以选择最优节点。

## 5. Android 平台的流量分流与控制
Android 系统支持强大的流量控制：
- **按域名/地理位置分流**：区分国内外流量。
- **按应用 (Per-App) 分流**：指定特定 APP 走代理或直连。

## 6. 网络测速与节点性能评估
通过对不同节点的延迟、带宽及流媒体解锁情况进行量化评估。

| 序号 | 节点名称 | 类型 | 平均速度 | 最高速度 | TLS RTT | HTTPS 延迟 | Netflix | YouTube | TikTok | ChatGPT |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | 香港 01 | Shadowsocks | 11.99MB | 14.79MB | 81ms | 407ms | OK(HK) | OK(HK) | OK(TW) | OK(SG) |

## 7. 工具进阶与延伸阅读
### 7.1 配置转换工具
常用的配置转换工具：[clash.skk.moe/proxy](https://clash.skk.moe/proxy)

### 7.2 延伸阅读
- [漫谈各种黑科技 DNS 技术在代理环境中的应用](https://tachyondevel.medium.com/%E6%BC%AB%E8%B0%88%E5%90%84%E7%A7%8D%E9%BB%91%E7%A7%91%E6%8A%80%E5%BC%8F-dns-%E6%8A%80%E6%9C%AF%E5%9C%A8%E4%BB%A3%E7%90%86%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8-62c50e58cbd0)
